version: "3.8"

services:
  watchtower:
    image: containrrr/watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - type: bind
        source: ~/.docker/config.json
        target: /config.json
    environment:
      WATCHTOWER_LABEL_ENABLE: true
    command: --interval 5

  website:
    image: localhost:5000/miska_website:latest
    deploy:
      labels:
        centurylinklabs.watchtower.enable: true
    restart: always
    build: ./website/
    volumes:
      - ./website/src/:/usr/src/miska/website/src/
      - ./website/server/:/usr/src/miska/website/server/
      - ./website/pages/:/usr/src/miska/website/pages/
      - ./website/public/:/usr/src/miska/website/public/
      - ./database/content/:/usr/src/miska/database/content/
    ports:
      - 6969:6969
    depends_on:
      - db

  db:
    restart: always
    image: mongo:latest
    volumes:
      - ./database/mongodb/:/data/db/
    env_file:
      - ./database/.env
    ports:
      - 27017:27017
